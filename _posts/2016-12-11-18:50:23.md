---
layout: post
category: 생활수리
title: '나의 WOL(Wake On Lan : 웨이크 온 랜) 성공기'
comments: true
---

2016-12-11 18:50:23


날씨가 추워짐에 따라 원격지에 있는 컴퓨터에 가는 것이 매우 힘든 일이 되어버린 요즘.

  

네트워크 기초가 없지만 WOL에 성공한 과정을 여기에 기록해두고, 나중에 포맷에 대한 대비와 혹여 통신사에서 기본으로 제공하는 장비만으로
WOL 및 RD 기능을 사용하고자 하는 사람이 이 글을 보고 도움이 되었으면 하는 바람으로 정리해봅니다.

  

0.목표

\- 사무실에 있는 데스크톱 1대를 WOL(Wake On Lan)과 RD(Remote Desktop) 기능이 가능하도록 설정하고 이용하는
것.

\- 추가 장비 구매 없이 해결하는 것. (가장 쉬운 방법은 WOL기능이 지원되는 iptime 공유기를 구매하는 것인 것 같다.)

1\. 환경

\- 운영체제 : MS windows 10 (레드스톤)

\- CPU :

![][link0]


\- 메인보드 :

![][link1]

\- 랜카드 :

이름 : Realtek PCIe GBE Family Controller (리얼텍 내장 랜카드)  

드라이버 버전 : 10.6.1001.2015

드라이버 날짜 : 2015-10-01

  

\- 네트워크 환경 :

1차 공유기 : MNG-6600 - SKB에서 임대받은 기본 제품, 모뎀 겸 유선 공유기

2차 공유기 : H724G (제조사 : DavoLink) - SKB에서 임대받은 기본 제품, 유무선 공유기

  

1차 공유기에 인터넷 전화기모뎀(G501), 2차 공유기가 물려있음

2차 공유기에 데스크탑, IP카메라(cctv) 이 물려있음

  

1차 공유기에 데스크탑을 물려보면 IP 대역이 **211**.xxx.xxx.xxx 이고, 2차 공유기에 데스크탑을 물려보면 IP 대역이
**192.168**.xxx.xxx 이다.

2차 공유기의 외부 아이피는 IP대역이 **61**.xxx.xxx.xxx 이다.


 ====> IP 대역이 192.168.xxx.xxx. 라는 건 VPN(가상 사설 네트워크)이란 것으로 해석하면 되고, 최초 공인
아이피는 211대역인데 1차 공유기에서 2차 공유기에 NAT(Network Address Translation) 해준 IP대역이 61대역인
것으로 볼 수 있다. 그리고 2차 공유기에서 데스크톱 및 무선으로 연결하는 스마트폰, 노트북 등등 기기에 192.168. 대역을 할당해준다.

  

2\. 환경설정

\- 바이오스 설정 :

바이오스 설정에 대한 스크린샷은 찍기 귀찮아서 생략한다. 메인보드마다 바이오스가 다 다르기 때문에 다른 사람이 찍은 사진을 봐도 큰 도움이
되지 않았다. 뭐, MSI 바이오스 사진을 못 봐서 그런 거겠지만, MSI 바이오스의 경우, "Settings" 항목에서 WOL 설정과
관련된 항목을 찾아 설정하면 된다.

  

글 쓰다가 google image에서 도움이 될만한 사진을 가져왔다. 같은 MSI라도 다 다를 수 있으니 자기 거에 맞는 WOL 관련 설정을
찾는다.

  

팁으로, MSI는 "PCIe 장치로 Resume 가능하도록"이란 용어를 쓰는 것 같다.


 **참고로 WOL을 하기 위한 목표를 이루기 위한  모든 설정은 "전력관리"와 "매직패킷통과"이다.**

  

설정은 Settings - Advanced 에서 한다.

![msi bios wake에 대한 이미지
검색결과](http://kb.stonegroup.co.uk/kb_upload/image/msi_h81_usb_wake2.png)

  

Wake Up Event Setup 에서 설정 가능하단다.

![][link2]


 **이건 사진과 차이가 있는데, 빨간 박스 안에 있는 설정은 관계없고 바로 위의 "Resume By PCI-E Device"를 Enabled 로 바꿔주어야 한다.** 내가 찍은 사진이 아니라...

![][link3]

  

EuP 2013 : 에너지(전력) 관련 옵션이므로 꺼두어야한다. (Power Management Setup에 있었던 것 같다.)

![msi bios wol에 대한 이미지 검색결과](http://64.183.18.101/faq/images/eup2013.jpg)

  

MSI 바이오스 사진의 출처는 구글검색(키워드 : MSI BIOS WOL)이다. ※ 그 외 사진들은 내가 캡쳐


\- OS(Windows) 설정 :

(1)

장치관리자(devmgmt.msc)에서 '네트워크 어댑터' 트리를 열고(더블 클릭하고) 안에 있는 Realtek .... 이라고 표시되어 있는 내 랜카드를 더블클릭하여 속성창을 띄운다.

'고급' 탭에서

  

Gigabit 자동 비활성화(절전) : 사용 안 함

WOL 및 종료 링크 속도 : 속도 저하 안 함

매직 패킷 웨이크 온 : 사용

에너지 효율적인 이더넷 : 사용 안 함

절전형 이더넷 : 사용 안 함

패턴 일치 웨이크 온 : 사용 안 함

![][link4]

으로 설정해주고, '전원 관리' 탭에서

![][link5]

위와 같이 설정해준다. 어떤 사람들은 3번째 항목인 "매직 패킷에서만..." 도 체크해야 한다고 하는데, 체크 해도 되고 안 해도 될 것 같다. 절전모드일때 간혹 랜카드에 의해서 절전모드가 해지되는 경우가 있는데 이를 방지하기 위해서 매직패킷에서만 절전 모드를 해지하도록 설정하는 옵션이다. 나는 컴퓨터를 절전모드로 두지 않기 때문에 해당이 없는데, 이 옵션은 필요에 의해 설정하면 될 듯.  

  

(2)

전원 옵션

  

고성능으로 하고 디스플레이 끄기와 컴퓨터를 절전 모드로 설정을 해당 없음으로 설정한다.

![][link6]

  

다음은 전원 단추 정의 및 암호 보호 설정인데, 여기서는 논란의 여지(?)가 있는 듯하다.

아래쪽에 있는 '종료 설정'에 대한 부분인데, '빠른 시작 켜기(권장)' 항목을 켜야한다는 사람도 있고 꺼야한다는 사람도 있다.

나의 경우에는 아래처럼 체크가 되어 켜져 있어야 WOL이 가능했음을 확인했다. 해당 옵션을 껐을 경우 WOL이 안 되는 것을 직접 경험했다. 
이건 뭐 알아서 체크했다 해제했다 해보면 될 것 같다... 설정을 바꾸려면 "현재 사용할 수 없는 설정 변경"을 누르고 체크 선택/해지하면 된다.

![][link7]

(3)  

방화벽 인바운드 규칙 설정


공유기 단에서 DMZ를 설정 하겠지만, 윈도우에서도 WOL을 보내고 받을 포트를 열어주어야 하는 것으로 알고 있다.


윈도우 검색에서 '방화벽'이라고 검색하면 '고급 보안이 포함된 Windows 방화벽' 을 열 수 있다.

여기서 왼쪽 탭의 '인바운드 규칙'을 누른 후 오른쪽 탭에 '새 규칙'을 눌러서 TCP 포트 7번과 9번(내가 사용할 포트 / 하나만 해도 되는데 그냥 7번과 9번을 가장 많이 쓴다기에 2개 다 했다. / 아무거나 해도 될 거다 아마...)을 개방해준다. 나중에 알게 된 사실이지만 매직패킷은 UDP포트를 통해 보내는 것 같다. 그래서 UDP 포트 7, 9번도 열어주기로 했다. 그런데 UDP 포트를 열어주지 않고 TCP포트만 열려있어도 WOL은 잘 되는 것을 확인하였다.

![][link8]
  

(4)

다음은 2차 공유기 설정화면이다. H724G의 경우 192.168.35.1 (기본게이트웨이) 으로 접속하면 관리할 수 있는 페이지가
로딩된다.

  

DMZ 설정은 편의상 모든 포트를 개방하기 위하여 설정하였다. 포트포워딩도 설정하긴 했으나 현재는 테스트용으로 DMZ Enable 상태이다.


![][link9]

  

포트포워딩 정보도 기록해두자면,

![][link10]

이렇다.  

  

참고로 공유기 모드는 공유기 모드(게이트웨이 모드)이다.(브릿지, AP모드가 아니다.)

참고로 데스크탑은 VPN에서 고정 아이피를 할당했다.


환경 설정이 모두 끝났다. 공유기, 데스크탑을 재부팅.

  

참고로 이런 환경설정을 하고나면 데스크탑 메인보드 뒤쪽에 보면 전원이 꺼져도 랜 카드 불이 계속 들어와있는 게 대부분이라고 하는데 나의 경우에는 그렇지 않고 불이 다 꺼졌다. 그래서 안 되려나 생각하고 있는데 매직패킷을 쏘니까 잘 되네?
  

3\. WOL 및 RD 실행

WOL을 실행하기 위해서는 스마트폰 어플이나 인터넷을 이용하면 된다.

인터넷을 이용한 방법은 https://www.depicus.com/wake-on-lan/woli 에서 가능하다.
  

실행하기 전에 데스크탑의 mac 주소를 알아야 하는데, 몇번 하다보면 외워진다.

mac 주소 확인은 cmd 에서 ipconfig -all 명령어로 확인 가능한데, '물리적 주소' 라고 되어 있는 부분이 바로 그것이다.


외부 아이피, 나의 경우에는 2차 공유기의 외부 주소인 61대역의 IP 주소의 7번 포트로 매직패킷을 쏘면 1초도 안 되 컴퓨터가 켜지는 것을 확인하였다.


RD는 기본 설정 포트가 3389인데 이건 예전에 설정해둔 것이라 이 글에서 따로 적지는 않지만 잘 된다.


이제 모든 작업을 집에서 할 수 있게 되었고, 외부에서 아이폰으로 켜고 접속해서 간단하게 클라우드 PC처럼 쓸 수도 있게 됐다. 나중에 돈 모이면 SSD를 달아주면 더 효과적으로 쓸 수 있을 것 같다.


4\. DDNS 설정

무료 DDNS를 제공해주는 no-ip 에 가입하고 서비스를 이용하고 있다. 아이피가 변경되면 자동으로 잘 잡아주는 것 같다. 윈도우에 클라이언트 프로그램을 깔아야 한다고 해서 깔긴 깔았는데 없어도 no-ip에서 자동으로 감지를 해서 변경된 아이피로 잘 연결시켜주는 것 같다.(랜선 뺐다 꽂고, 브릿지모드로 했다 리셋 했다 해보면서 no-ip에서 확인함)

4\. 정리

WOL의 핵심은 절전 해제와 매직패킷통과이다.

모든 것을 마친 후 궁금한 점이 생겼다.

  

포트가 열려있는지 아닌지 확인하는 사이트인 you get signal에서 확인해보면

데스크톱이 켜져있을 때 3389 포트는 열려있는데, 7번, 9번은 닫혀있다. 왜 일까?

물론 데스크톱이 꺼져있을 때는 3389 포트도 닫혀있다. 그러니 2차 공유기에서는 DMZ설정을 했지만 1차 공유기에서 포트를 모두 다 닫아서 그럴 것 같은 느낌인데 3389번은 운영체제(윈도우즈)에서 열리면 DMZ 되어 있기 때문에 외부에서 열리는 것으로 바뀌나? 그럼 운영체제에서 설정한 7번, 9번 포트도 컴퓨터가 켜지면 열려야 하는 것 아닌가?

그리고 컴퓨터가 꺼져있고 해당 포트가 닫혀있는 것으로 확인이 되는데 어떻게 7번, 9번 포트로 매직패킷이 통과할 수 있는 걸까? 이건 분명 DMZ 또는 포트포워딩 때문인 것 같은데...

  

1차 공유기(정확히는 모뎀, 허브??)는 2차 공유기처럼 관리하는 페이지가 따로 없는 것 같다. 있으면 좋겠는데... 없는 게 당연한건가?


이런 저런 테스트가 끝나면 혹시 모를 보안을 위해서 DMZ를 disable 시키고 WOL이 되는지 테스트 해봐야 겠다.
  

어쨌든 성공했다.


[link0]:https://t1.daumcdn.net/cfile/tistory/27246150584D121B10
[link1]:https://t1.daumcdn.net/cfile/tistory/2219CE4D584D123B26
[link2]:http://kb.stonegroup.co.uk/kb_upload/image/msi_h81_usb_wake3.png
[link3]:http://kb.stonegroup.co.uk/kb_upload/image/msi_h81_usb_wake4.png
[link4]:https://t1.daumcdn.net/cfile/tistory/275E3C4B584D1A681F
[link5]:https://t1.daumcdn.net/cfile/tistory/264E134E584D1A8D12
[link6]:https://t1.daumcdn.net/cfile/tistory/273B7548584D1B6427
[link7]:https://t1.daumcdn.net/cfile/tistory/234A6C48584D1BA91A
[link8]:https://t1.daumcdn.net/cfile/tistory/235AB150584D1D1A0F
[link9]:https://t1.daumcdn.net/cfile/tistory/23270E4C584D17520B
[link10]:https://t1.daumcdn.net/cfile/tistory/261A994C584D1D5533
